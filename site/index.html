<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Input Fields</title>
  <style>
    body {
      font-family: 'Fira Code', sans-serif;
      margin: 20px;
    }
    .input-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .input-number {
      margin-right: 5px;
    }
    .output-text {
      margin-left: 10px;
    }
    .dynamic-input {
        font-family: 'Fira Code', monospace;
    }
  </style>
</head>
<body>

<div><span id="isValid" class="valid">Valid</span></div>

<div id="inputContainer">
  <div class="input-row" id="inputRow1">
    <span class="input-number">1.</span>
    <input type="text" id="input1" class="dynamic-input" onkeydown="handleKeyDown(event, 1)" onblur="handleBlur(1)">
    <span class="output-text"></span>
  </div>
</div>

<script src="prooftree.js"></script>

<script>
  let biggestInputNumber = 1;

  function handleKeyDown(event, inputNumber) {
    const inputElement = document.getElementById('input' + inputNumber);

    if (event.key === 'Enter') {
      event.preventDefault();

      if (inputNumber === biggestInputNumber) {
        createNewInput(inputNumber + 1);
      } else {
        // Move to the input field below without creating a new one
        const nextInput = document.getElementById('input' + (inputNumber + 1));
        if (nextInput) {
          nextInput.focus();
        }
      }
    } else if (event.key === 'Backspace' && inputElement.value === '' && inputNumber > 1) {
      event.preventDefault();
      deleteInput(inputNumber);
    }
  }

  function deleteInput(inputNumber) {
    const inputRow = document.getElementById('inputRow' + inputNumber);
    inputRow.remove();
    updateOutputText(inputNumber - 1);
    if (inputNumber === biggestInputNumber) {
      biggestInputNumber--;
    }

    // Set focus to the input field above after deletion
    const previousInput = document.getElementById('input' + (inputNumber - 1));
    if (previousInput) {
      previousInput.focus();
    }
    if (Prooftree.deleteline(inputNumber)) {
        isValid.textContent = 'Valid';
    } else {
        isValid.textContent = 'Invalid';
    }
  }

  function handleBlur(inputNumber) {
    updateOutputText(inputNumber);
  }

  function updateOutputText(inputNumber) {
    const inputElement = document.getElementById('input' + inputNumber);
    const outputTextElement = document.getElementById('inputRow' + inputNumber).getElementsByClassName('output-text')[0];
    outputTextElement.textContent = Prooftree.interp(inputElement.value);
    if (Prooftree.editline(inputNumber, inputElement.value)) {
        isValid.textContent = 'Valid';
    } else {
        isValid.textContent = 'Invalid';
    }
  }

  function createNewInput(newInputNumber) {
    const inputContainer = document.getElementById('inputContainer');
    biggestInputNumber = newInputNumber;

    const inputRow = document.createElement('div');
    inputRow.className = 'input-row';
    inputRow.id = 'inputRow' + newInputNumber;

    const inputNumberSpan = document.createElement('span');
    inputNumberSpan.className = 'input-number';
    inputNumberSpan.textContent = newInputNumber + '.';

    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'input' + newInputNumber;
    input.className = 'dynamic-input';
    input.onkeydown = function (event) {
      handleKeyDown(event, newInputNumber);
    };
    input.onblur = function () {
      handleBlur(newInputNumber);
    };

    const outputTextSpan = document.createElement('span');
    outputTextSpan.className = 'output-text';

    inputRow.appendChild(inputNumberSpan);
    inputRow.appendChild(input);
    inputRow.appendChild(outputTextSpan);
    inputContainer.appendChild(inputRow);

    // Move the cursor to the newly created input field
    input.focus();
  }
</script>

</body>
</html>
